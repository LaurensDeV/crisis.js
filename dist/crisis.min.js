/**
 * @name		crisis.js
 * @uri			https://github.com/mookman288/crisis.js
 * @author		PxO Ink
 * @license		MIT
 * @copyright	2016 PxO Ink. Some Rights Reserved. 
 */
"use strict";var crisis=function(e){if("object"==typeof e)for(var i in e)e.hasOwnProperty(i)&&(this[i]=e[i]);return this.buildRegex(),this.automatic&&this.process(),this};crisis.prototype.automatic=!0,crisis.prototype.inputs=["input[type=text]","textarea"],crisis.prototype.search={suicide:{combinations:[{primary:["kill","hurt","cut"],secondary:["myself","herself","himself"]},{primary:["commit"],secondary:["suicide"]},{primary:["end it"],secondary:["all","now"]}],strings:["want to die"]},ipv:{combinations:[{primary:["hit","beat","cut","abus","stalk","hurt"],secondary:["me","her","him"]},{primary:["am","i'm","is","he's","she's","are","they're"],secondary:["scared","afraid","terrified"]},{primary:["been","be","is"],secondary:["beat","cut","abus","stalk","hurt"]}]},sar:{combinations:[{primary:["rap","touch","grop","fondl"],secondary:["me","her","him"]},{primary:["been","be","is"],secondary:["rap","touch","grop","fondl"]}]}},crisis.prototype.template="Would you like help for you, or someone you know,",crisis.prototype.helpString={suicide:"who is in danger of hurting themselves or committing suicide?",ipv:"who is suffering from intimate, emotional, or physical abuse or violence?",sar:"who has experienced sexual assault, rape, or inappropriate contact?"},crisis.prototype.redirects={suicide:"http://www.suicide.org/if-you-are-suicidal.html",ipv:"http://www.thehotline.org/help/",sar:"https://rainn.org/get-help"},crisis.prototype.waitTime=500,crisis.prototype.nodes={},crisis.prototype.regex={},crisis.prototype.buildRegex=function(){for(var e in this.search)if(this.search.hasOwnProperty(e)){if(this.regex[e]=this.regex[e]||[],"object"==typeof this.search[e].combinations)for(var i=0;i<this.search[e].combinations.length;i++)for(var t=0;t<this.search[e].combinations[i].primary.length;t++)for(var s=0;s<this.search[e].combinations[i].secondary.length;s++)this.regex[e].push(new RegExp(this.search[e].combinations[i].primary[t].replace(/\s+/,"\\s+")+"[e|s|d|es|ed|ing|ting]*\\s+"+this.search[e].combinations[i].secondary[s].replace(/\s+/,"\\s+")+"[e|s|d|es|ed|ing|ting]*","gi"));if("object"==typeof this.search[e].strings)for(var t=0;t<this.search[e].strings.length;t++)this.regex[e].push(new RegExp(this.search[e].strings[t].replace(/\s+/,"\\s+"),"i"))}},crisis.prototype.detect=function(e){if("undefined"!=typeof this.nodes[e].input)for(var i in this.regex)if(this.regex.hasOwnProperty(i))for(var t=0;t<this.regex[i].length;t++)if(console.log(this.nodes[e].input.value.search(this.regex[i][t])),this.nodes[e].input.value.search(this.regex[i][t])>-1){confirm(crisis.template.trim()+" "+crisis.helpString[i])&&window.open(crisis.redirects[i],"_blank").focus(),crisis.deactivate(e);break}},crisis.prototype.activate=function(e){if("undefined"!=typeof this.nodes[e]&&this.nodes[e]){var i=this;this.nodes[e]={input:this.nodes[e],uid:e,handler:null},this.nodes[e].input.setAttribute("data-crisis-id",e),this.nodes[e].handler=function(e){i.detect(e)},this.nodes[e].timer=null,this.nodes[e].input.oninput=function(){var e=this.getAttribute("data-crisis-id");return clearTimeout(i.nodes[e].timer),i.nodes[e].timer=setTimeout(function(){i.nodes[e].handler(e)},i.waitTime),!0},this.nodes[e].input.onpropertychange=this.nodes[e].input.oninput}},crisis.prototype.deactivate=function(e){"undefined"!=typeof this.nodes[e]&&this.nodes[e]&&(this.nodes[e].handler=function(){return!0})},crisis.prototype.generate=function(){return Math.floor(1649374544727*Math.random()).toString(16)},crisis.prototype.getNodes=function(){for(var e=0;e<this.inputs.length;e++)return document.querySelectorAll(this.inputs[e])},crisis.prototype.process=function(e){for(var e=this.getNodes(),i=0;i<e.length;i++){var t=this.generate();this.nodes[t]=e[i],this.activate(t)}};