/**
 * @name		crisis.js
 * @uri			https://github.com/mookman288/crisis.js
 * @author		PxO Ink
 * @license		MIT
 * @copyright	2016 PxO Ink. Some Rights Reserved. 
 */
crisis=function(t){if("object"==typeof t)for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);return this},crisis.prototype.lang={intro:"Would you like help for you, or someone you know, who",types:{suicide:{helpText:"is in danger of hurting themselves or committing suicide?",redirect:"http://www.suicide.org/if-you-are-suicidal.html",combinations:[{primary:["kill","hurt","cut"],secondary:["myself","herself","himself"]},{primary:["commit"],secondary:["suicide"]},{primary:["end it"],secondary:["all","now"]}],strings:["want to die"]},ipv:{helpText:"is suffering from intimate, emotional, or physical abuse or violence?",redirect:"http://www.thehotline.org/help/",combinations:[{primary:["hit","beat","cut","abus","stalk","hurt"],secondary:["me","her","him"]},{primary:["am","i'm","is","he's","she's","are","they're"],secondary:["scared","afraid","terrified"]},{primary:["been","be","is"],secondary:["beat","cut","abus","stalk","hurt"]}]},sar:{helpText:"has experienced sexual assault, rape, or inappropriate contact?",redirect:"https://rainn.org/get-help",combinations:[{primary:["rap","touch","grop","fondl"],secondary:["me","her","him"]},{primary:["been","be","is"],secondary:["rap","touch","grop","fondl"]}]}}},crisis.prototype.automatic=!0,crisis.prototype.inputs=["input[type=text]","search","textarea"],crisis.prototype.waitTime=500,crisis.prototype.nodes={},crisis.prototype.regex={},crisis.prototype.init=function(){return this.buildRegex(),this.automatic&&this.process(),this},crisis.prototype.buildRegex=function(){for(var t in this.lang.types)if(this.lang.types.hasOwnProperty(t)){if(this.regex[t]=this.regex[t]||[],"object"==typeof this.lang.types[t].combinations)for(var e=0;e<this.lang.types[t].combinations.length;e++)for(var i=0;i<this.lang.types[t].combinations[e].primary.length;i++)for(var s=0;s<this.lang.types[t].combinations[e].secondary.length;s++)this.regex[t].push(new RegExp(this.lang.types[t].combinations[e].primary[i].replace(/\s+/,"\\s+")+"[e|s|d|es|ed|ing|ting]*\\s+"+this.lang.types[t].combinations[e].secondary[s].replace(/\s+/,"\\s+")+"[e|s|d|es|ed|ing|ting]*","gi"));if("object"==typeof this.lang.types[t].strings)for(var r=0;r<this.lang.types[t].strings.length;r++)this.regex[t].push(new RegExp(this.lang.types[t].strings[r].replace(/\s+/,"\\s+"),"i"))}},crisis.prototype.detect=function(t){if("undefined"!=typeof this.nodes[t].input)for(var e in this.regex)if(this.regex.hasOwnProperty(e))for(var i=0;i<this.regex[e].length;i++)if(this.nodes[t].input.value.search(this.regex[e][i])>-1){confirm(crisis.lang.intro.trim()+" "+crisis.lang.types[e].helpText)&&window.open(crisis.lang.types[e].redirect,"_blank").focus(),crisis.deactivate(t);break}},crisis.prototype.activate=function(t){if("undefined"!=typeof this.nodes[t]&&this.nodes[t]){var e=this;this.nodes[t]={input:this.nodes[t],uid:t,handler:null},this.nodes[t].input.setAttribute("data-crisis-id",t),this.nodes[t].handler=function(t){e.detect(t)},this.nodes[t].timer=null,this.nodes[t].input.oninput=function(){var t=this.getAttribute("data-crisis-id");return clearTimeout(e.nodes[t].timer),e.nodes[t].timer=setTimeout(function(){e.nodes[t].handler(t)},e.waitTime),!0},this.nodes[t].input.onpropertychange=this.nodes[t].input.oninput}},crisis.prototype.deactivate=function(t){"undefined"!=typeof this.nodes[t]&&this.nodes[t]&&(this.nodes[t].handler=function(){return!0})},crisis.prototype.generate=function(){return Math.floor(1649374544727*Math.random()).toString(16)},crisis.prototype.getNodes=function(){for(var t=[],e=0;e<this.inputs.length;e++)for(var i=document.querySelectorAll(this.inputs[e]),s=0;s<i.length;s++)t.push(i[s]);return t},crisis.prototype.process=function(t){t=this.getNodes();for(var e=0;e<t.length;e++){var i=this.generate();this.nodes[i]=t[e],this.activate(i)}};